---
title: "ST 558 - Project 2"
author: "Paula Bailey and Yi Ren"
date: "2022-09-22"
---
Pokémon inhabit the world of the Pokémon games. The franchise was created by Satoshi Tajiri in 1996. These fictional creatures can be caught using Pokéballs and trained by battling with other Pokémon. There are current 920 species according to Wikipedia. 

This vignette will walk the reader through the process of connecting to & collecting data from PokeAPI <https://pokeapi.co/> within R programming environment.


## Reference to Render Code
```{r, Render, eval=FALSE}
rmarkdown::render("Project2.Rmd", "github_document","README.md")
```


## Packages for Vignette

The following packages are required for connecting and retrieving data from the API.

1. `httr` - _Retrieves Data from an API_
2. `jsonlite` - _Parses Results from an API Query_
3. `dplyr` - _A part of the `tidyverse` used for manipulating data_
4. `tidyr` - _A part of the `tidyverse` used for data cleaning and 'tidying'_
4. `ggplot2` - _A part of the `tidyverse` used for creating graphics_

```{r libraries, message=FALSE, warning=FALSE}
# Read in Required Packages 
library(httr)
library(jsonlite)
library(tidyverse)
library(ggplot2)

```

  



------TYPE
## Function for obtaining obtaining type
The type (number) is necessary to find any moe information
```{r }
get_type <- function(type = fire){
  base<-"https://pokeapi.co/api/v2/type/"
  url<-(paste0(base,type,"/"))
  type_api<-GET(url) %>% content("text") %>% fromJSON(flatten=TRUE)
  
  type <-tibble(typeID = type_api[["id"]],
                move =type_api[["moves"]][[1]][[1]])
  return(type)
}

```

------MOVES


```{r}
get_moves <- function(type=10){
  base<-"https://pokeapi.co/api/v2/move/"
  url<-(paste0(base,type,"/"))
  move_api<-GET(url) %>% content("text") %>% fromJSON(flatten=TRUE)
  #move_ailments_api<-lookup_moves("move-ailment", type) 
  #move_battleStyle_api<-lookup_moves("move-battle-style", type) 
  #move_categories_api<-lookup_moves("move-category", type) 
  #move_damageClass_api<-lookup_moves("move-damage-class",type) 
  #move_learnMethod_api<-lookup_moves("move-learn-method", type) 
  #move_target_api<-lookup_moves("move-target", type) 
  
  
moves <- tibble(
  idMove =move_api[["id"]],
  nameMove=move_api[["name"]],
  accuracy = move_api[["accuracy"]],
  power = move_api[["power"]],
  PowerPoint = move_api[["pp"]],
  #Ailments = move_ailments_api[["moves"]][[1]],
  #battle = move_battleStyle_api[["name"]],
  #target = move_target_api[["name"]]
)


  return(moves)

}
```



------BERRY


This next section will pull information about the pokemon berry from the api. Berries are small fruits that can provide restoration, stat enhancement, and even damage negation when eaten by Pokémon. https://bulbapedia.bulbagarden.net/wiki/Berry
information seems to be the only information that is worth plotting. 


Gets data for the first berry and puts it into a df
```{r }
res = GET("https://pokeapi.co/api/v2/berry/1/") 
api_text<-content(res,"text")
api_json<-fromJSON(api_text,flatten=TRUE)
```

```{r}
berries_df <- as.data.frame(api_json)
```

Gets data for the remaining berries and combines into first berry df.
```{r}
for(i in 2:64){
  #increment through each berry until we get all 64 berries
  base <- "https://pokeapi.co/api/v2/berry/"
  call_next <- (paste0(base,i,"/"))
  
  res2 = GET(call_next) 
  api_text2<-content(res2,"text")
  api_json2<-fromJSON(api_text2,flatten=TRUE)
  
  next_df <- as.data.frame(api_json2)
  
  berries_df <- rbind(berries_df,next_df)
  

}
```




summarize 
```{r}
table(berries_df$flavors.flavor.name, berries_df$growth_time)
```


```{r}
table(berries_df$flavors.flavor.name, berries_df$flavors.potency)
```

Numerical Summary - Growth Time
```{r}
summary(berries_df$growth_time)
```

Numerical Summary - Soil Dryness
```{r}
summary(berries_df$soil_dryness)
```

Correlation
The is a strongly negative correlation between berry growth time and soil dryness.
As the berry grows, the soil becomes drier.
```{r}
cor(berries_df$growth_time,berries_df$soil_dryness)
```

There is a positive correlation between natural gift power and the size of berry.
As the berry grows, the natural gift power increases. This gift deals damage with 
no additional effects.  However, the damage depends on the type of berry consumed.
```{r}
cor(berries_df$natural_gift_power, berries_df$size)
```


There does appear to be a positive relationship between the type of berry and damage
received from the berry
```{r}
cor(berries_df$id, berries_df$natural_gift_power)
```





```{r berrySummary}
berrySummary <- berries_df %>% select(flavors.potency, growth_time, max_harvest, natural_gift_power, size, smoothness, soil_dryness) %>% apply(2, function(x){summary(x[!is.na(x)])}) 
knitr::kable(berrySummary, caption = 'Summary of Berry Stats', digits = 2)
```


Categorical chart


# Bar Plot
This bar plot show the categories of flavor for berry which are grouped by their firmness.
The soft berries comprise a larger number of the berries.  It does not matter what the
flavor of the berry is.
```{r bar, out.width = "60%", fig.align = "center"}
ggplot(berries_df,aes(y = flavors.flavor.name, fill = firmness.name)) + geom_bar(position="dodge") + labs(y="Flavor of Berry") + scale_fill_discrete(name="Firmness") + theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5))
```



# Histogram
This histogram shows the distribution of growing time for berries.  It
show a bimodal distribution.  
```{r histogram berries, out.width = "60%", fig.align = "center"}
	g<-ggplot(berries_df,
	          aes(x = growth_time))
	g + geom_histogram(bins = 5) + 
	    labs(x = "Growth Time",title = "Histogram of Berry Growth Time")  + 
	    theme(legend.title =    element_text(size = 5), legend.text = element_text(size = 5))
```

# Scatter plot
The scatter plot visually verifies the negative relationship between the growth of berries and soil dryness.  As the berry grows, the soil becomes drier.
```{r, out.width = "60%", fig.align = "center"}
	g<-ggplot(berries_df,
	          aes(x = growth_time, y = soil_dryness))
	  g + geom_smooth(formula = y~x, method = "loess") + 
	      geom_point() +
	      labs(x = "Growth Time",title = "Berry Growth Time") 
```	  

We want to see if having a higher BMI (weight/height) results in a slower speed.
We can see a couple of pokemons with a higher BMI which have a slower speed.
In general, there does not appear to be relationship.     ADD ME**
```{r, out.width = "60%", fig.align = "center"}
	g<-ggplot(poke,
	          aes(x = round((weight/height),2), y = speed))
	  g + geom_point(aes(color = type)) +
	      labs(x = "BMI", y= "Speed",title = "Body Mass Index (BMI) and Speed") +
	     theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5))
```